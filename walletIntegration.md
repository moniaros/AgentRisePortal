# AgentOS Integration PRD: Customer Insurance Wallet

**Version:** 1.0  
**Status:** For Engineering Review  
**Author:** Product Management Office  
**Date:** October 26, 2024

---

## 1. Executive Summary

This document outlines the technical requirements for integrating the AgentOS platform with a customer-facing mobile insurance wallet application. The primary goal is to empower end-customers with direct, mobile-first access to their policy information, AI-powered insights, and key services.

This integration will be facilitated through a secure, versioned RESTful API. This document provides a blueprint for the required API endpoints, data models, authentication mechanisms, and future enhancement considerations for a full-stack development team.

---

## 2. Core Features & User Stories

The integration will expose the following key features from AgentOS to the customer wallet app:

1.  **Unified Policy View:** Customers can see all their active and inactive policies in one place.
    *   *User Story:* "As a customer, I want to view all my insurance policies (Auto, Home, Life) in a single app so I don't have to search through emails or paper documents."

2.  **AI-Powered Policy Simplification:** Customers can view the simplified, "plain English" summaries of their policies generated by the Gemini API.
    *   *User Story:* "As a customer, I want to understand what my policy *actually* covers without reading legal jargon, so I can feel confident in my protection."

3.  **Digital Service Requests:** Customers can initiate common service requests directly from the app.
    *   *User Story:* "As a customer, I want to request a change to my policy (e.g., update my address) from my phone to save time."

4.  **First Notice of Loss (FNOL):** Customers can start the claims process by submitting an initial notice of a loss or accident.
    *   *User Story:* "As a customer involved in a car accident, I want to immediately notify my agent and start the claims process from the scene."

5.  **Secure Document Access:** Customers can download official copies of their policy documents.
    *   *User Story:* "As a customer, I need to download a PDF of my auto insurance card to show as proof of insurance."

---

## 3. API Architecture & Endpoints

The integration will be built on a versioned REST API. All endpoints will be prefixed with `/api/v1/wallet`.

### 3.1 Authentication

Authentication must be secure and user-centric. We will implement the **OAuth 2.0 Authorization Code Flow**.

1.  The wallet app will redirect the user to a secure AgentOS login page.
2.  The user authenticates with their existing customer portal credentials.
3.  AgentOS issues a short-lived **Access Token** and a long-lived **Refresh Token** to the wallet app.
4.  The wallet app must include the Access Token in the `Authorization: Bearer <token>` header for all subsequent API requests.
5.  The wallet app must use the Refresh Token to obtain a new Access Token when the old one expires.

### 3.2 Data Models for API Payloads

The API will return simplified versions of the internal AgentOS data models.

**`PolicySummary` Object:**
```json
{
  "id": "pol1",
  "policyNumber": "CAR-12345",
  "type": "auto",
  "insurer": "Generali",
  "isActive": true,
  "premium": 350.50,
  "endDate": "2024-01-14"
}
```

**`PolicyDetail` Object:** (Extends `PolicySummary`)
```json
{
  // ...all fields from PolicySummary
  "startDate": "2023-01-15",
  "coverages": [
    { "type": "Bodily Injury", "limit": "â‚¬1,300,000" }
  ],
  "vehicle": { "make": "Fiat", "model": "500X", "year": 2019 }
}
```

**`Analysis` Object:**
```json
{
  "analysisId": "analysis_mock_1",
  "fileName": "Home_Policy_2024.pdf",
  "createdAt": "2024-10-25T10:00:00Z",
  "summary": "Your home insurance has significant gaps...",
  "riskScore": 75,
  "gaps": [
    { "area": "Earthquake Coverage", "recommendation": "Add full coverage" }
  ]
}
```

### 3.3 API Endpoints

| Method | Endpoint | Description | Response Body |
| :--- | :--- | :--- | :--- |
| `GET` | `/customer` | Fetches the logged-in customer's basic profile. | `{ "firstName": "Alexandros", "lastName": "Papageorgiou", "email": "..." }` |
| `GET` | `/policies` | Fetches a list of all policies for the customer. | `PolicySummary[]` |
| `GET` | `/policies/{policyId}` | Fetches detailed information for a single policy. | `PolicyDetail` |
| `GET` | `/policies/{policyId}/document` | Downloads the official policy document (PDF). | `file/pdf` |
| `GET` | `/analyses` | Fetches all available AI-powered analyses for the customer. | `Analysis[]` |
| `POST` | `/claims` | Submits a First Notice of Loss (FNOL). | `{ "status": "success", "claimId": "claim_xyz" }` |
| `POST` | `/service-requests` | Submits a generic service request. | `{ "status": "success", "requestId": "sr_abc" }` |

**Example `POST /claims` Request Body:**
```json
{
  "policyId": "pol1",
  "lossDate": "2024-10-26T18:00:00Z",
  "description": "Minor fender bender in parking lot. Other driver's info collected.",
  "photoAttachments": [
    { "fileName": "damage_1.jpg", "base64Data": "..." }
  ]
}
```

### 3.4 Push Notifications (via Webhooks)

To provide a real-time experience, AgentOS must push updates to the wallet app.

1.  The wallet app will register a secure webhook endpoint with AgentOS during initial setup.
2.  AgentOS will send a `POST` request to this endpoint when a relevant event occurs.

**Webhook Events:**
*   `policy.renewed`: Sent when an agent renews a policy.
*   `claim.status.updated`: Sent when an agent updates the status of a claim.
*   `timeline.new.message`: Sent when an agent adds a new note or message to the customer's timeline.
*   `document.new.available`: Sent when a new document (e.g., updated policy) is available.

---

## 4. Missing Features & Future Enhancements

The current AgentOS platform lacks several features that would add significant value to this integration. These should be prioritized in the backend roadmap.

1.  **Real-Time Chat API:**
    *   *Gap:* The current timeline is a one-way log.
    *   *Enhancement:* Implement a WebSocket-based chat API (`/chat`) to allow customers to communicate directly with their agent from the wallet app.

2.  **Digital Insurance Card Generation:**
    *   *Gap:* No service exists to generate verifiable digital documents.
    *   *Enhancement:* Create an endpoint (`GET /policies/{policyId}/digital-card`) that returns a payload compatible with Apple Wallet and Google Wallet passes. This is critical for auto insurance customers.

3.  **Payment Gateway Integration:**
    *   *Gap:* Billing is informational only.
    *   *Enhancement:* Integrate with Stripe or another payment provider. Expose endpoints to fetch invoices (`GET /billing/invoices`) and process payments (`POST /billing/invoices/{invoiceId}/pay`).

4.  **Customer Document Upload:**
    *   *Gap:* Customers cannot upload documents.
    *   *Enhancement:* Create a secure endpoint (`POST /documents/upload`) for customers to upload files (e.g., accident photos, competitor quotes) directly to their CRM timeline.

---

## 5. Security & Compliance

*   All API traffic **must** use HTTPS/TLS 1.2+.
*   Sensitive data (PII, policy details) must be encrypted at rest on the server.
*   API responses should be designed to expose only the data necessary for the wallet app's functionality (Principle of Least Privilege).
*   All data access and mutations through the API must be logged in the AgentOS Audit Log for compliance.
```